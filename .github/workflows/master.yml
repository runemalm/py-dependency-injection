name: Push on master

on:
  push:
    branches:
      - master

jobs:
  unittests:
    name: Run tests
    runs-on: ubuntu-latest

    strategy:
      matrix:
        python-version: [3.7, 3.8, 3.9, "3.10", 3.11, 3.12]
      fail-fast: false

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: setup pyenv
        uses: "gabrielfalcao/pyenv-action@v18"
        with:
          default: ${{ matrix.python-version }}
          # versions: 3.8.16, 3.5.7

      - name: Verify pyenv installation
        run: |
          pyenv --version
          pyenv versions

      # - name: Activate Python version
      #   run: |
      #     pyenv install --skip-existing "$(cat .python-version)"
      #     pyenv global "$(cat .python-version)"
      #     pyenv rehash

      - name: Install pipenv
        run: |
          python -m pip install --upgrade pip
          pip install pipenv

      # - name: Generate requirements.txt from Pipfile
      #   run: |
      #     pipenv lock -r > requirements.txt

      # - name: Install dependencies using pip
      #   run: |
      #     python -m pip install --upgrade pip
      #     pip install -r requirements.txt


      - name: Setup virtual environment
        run: |
          pipenv --python ${{ matrix.python-version }} install --dev --deploy

      # - name: Install dependencies
      #   run: |
      #     python -m pip install --upgrade pip
      #     pip install -r Pipfile

      - name: Run unittests
        run: pipenv run pytest ./tests
